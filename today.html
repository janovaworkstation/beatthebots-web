<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Today — Beat the Bots Daily</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,400;1,700&family=Courier+Prime:wght@400;700&family=EB+Garamond:ital,wght@0,400;1,400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/shared.css" />
  <style>
    /* ── TODAY-SPECIFIC ── */
    .page-hero {
      padding: 56px 48px 48px;
      border-bottom: 1px solid var(--muted);
      display: flex; justify-content: space-between; align-items: flex-end;
    }
    .page-hero-right { text-align: right; }
    .page-hero-right .date-label { font-family: 'Courier Prime', monospace; font-size: 10px; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); }
    .page-hero-right .date-value { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 700; color: var(--gold); }

    /* video embed */
    .episode-embed {
      background: var(--bg-elevated);
      border: 1px solid var(--muted);
      aspect-ratio: 16/9;
      display: flex; align-items: center; justify-content: center;
      position: relative; overflow: hidden; margin-bottom: 12px;
    }
    .embed-placeholder { text-align: center; }
    .embed-play {
      width: 64px; height: 64px;
      border: 2px solid var(--gold-dim);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 16px; cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
    }
    .embed-play:hover { border-color: var(--gold); background: rgba(201,160,82,0.1); }
    .play-tri { width:0; height:0; border-top:12px solid transparent; border-bottom:12px solid transparent; border-left:20px solid var(--gold); margin-left:4px; }
    .embed-title { font-family: 'Playfair Display', serif; font-size: 18px; font-weight: 700; color: var(--cream); }
    .embed-sub { font-family: 'Courier Prime', monospace; font-size: 10px; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); margin-top: 6px; }

    /* games grid */
    .games-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .game-card { padding: 28px; }
    .game-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
    .game-title { font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 700; color: var(--cream); }
    .game-meta { font-family: 'Courier Prime', monospace; font-size: 9px; letter-spacing: 0.16em; text-transform: uppercase; color: var(--muted); text-align: right; line-height: 1.6; }
    .result-row { display: flex; align-items: center; justify-content: space-between; padding: 9px 12px; background: var(--bg-elevated); margin-bottom: 6px; }
    .result-row:last-child { margin-bottom: 0; }
    .result-model { display: flex; align-items: center; gap: 8px; font-family: 'Courier Prime', monospace; font-size: 10px; letter-spacing: 0.14em; text-transform: uppercase; color: var(--cream-dim); }
    .result-score { font-family: 'Playfair Display', serif; font-size: 17px; font-weight: 700; }

    /* winner badge */
    .winner-badge { display: inline-flex; align-items: center; gap: 6px; background: rgba(201,160,82,0.12); border: 1px solid var(--gold-dim); padding: 3px 10px; font-family: 'Courier Prime', monospace; font-size: 9px; letter-spacing: 0.18em; text-transform: uppercase; color: var(--gold); margin-left: 8px; }

    /* loading / error states */
    .loading-state, .error-state {
      padding: 64px 0;
      text-align: center;
      font-family: 'Courier Prime', monospace;
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }
    .loading-state { color: var(--muted); }
    .error-state { color: var(--gold-dim); }
    .error-state strong { display: block; color: var(--cream-dim); font-size: 14px; margin-bottom: 8px; letter-spacing: 0.1em; }

    @media (max-width: 768px) {
      .games-grid { grid-template-columns: 1fr; }
      .page-hero { flex-direction: column; gap: 12px; align-items: flex-start; }
    }
  </style>
</head>
<body>

  <nav>
    <a href="index.html" class="nav-logo">Beat <span>the Bots</span> Daily</a>
    <ul class="nav-links">
      <li><a href="standings.html">Standings</a></li>
      <li><a href="today.html" class="active">Today</a></li>
      <li><a href="episodes.html">Episodes</a></li>
      <li><a href="models.html">Models</a></li>
    </ul>
    <a href="index.html#waitlist" class="nav-cta">Join Waitlist</a>
    <button class="nav-hamburger" onclick="document.querySelector('.nav-links').classList.toggle('open')">☰</button>
  </nav>

  <div class="page-content">

    <div class="band band-dark">
      <div class="page-hero inner" style="padding-top:48px;padding-bottom:40px;border-bottom:1px solid var(--muted);">
        <div>
          <span class="label">Daily Results</span>
          <h1 class="page-title serif">Today</h1>
        </div>
        <div class="page-hero-right">
          <div class="date-label" id="today-day">—</div>
          <div class="date-value" id="today-date">—</div>
        </div>
      </div>
    </div>

    <!-- TODAY'S EPISODE -->
    <div class="band band-raised">
      <div class="inner">
        <span class="label">Today's Episode</span>
        <h2 class="section-title serif" style="margin-bottom:24px;">Daily <span class="gold">Recap</span></h2>
        <div id="episode-embed-container" class="episode-embed bracketed">
          <div class="embed-placeholder">
            <div class="embed-play"><div class="play-tri"></div></div>
            <div class="embed-title" id="embed-title">Daily Recap</div>
            <div class="embed-sub">Who won today? Watch the full breakdown</div>
          </div>
        </div>
        <div style="font-family:'Courier Prime',monospace;font-size:10px;letter-spacing:0.15em;text-transform:uppercase;color:var(--muted);text-align:right;">
          <a id="episode-yt-link" href="https://www.youtube.com/@BeatTheBotsDailyApp" target="_blank" rel="noopener" style="color:var(--gold);text-decoration:none;">Watch on YouTube →</a>
          &nbsp;·&nbsp; <a href="episodes.html" style="color:var(--gold);text-decoration:none;">Browse all episodes →</a>
        </div>
      </div>
    </div>

    <!-- GAME RESULTS -->
    <div class="band band-dark">
      <div class="inner">
        <span class="label" id="results-date-label">—</span>
        <h2 class="section-title serif" style="margin-bottom:32px;">Game <span class="gold">Results</span></h2>
        <div id="games-grid-container">
          <div class="loading-state">Loading results…</div>
        </div>
      </div>
    </div>

  </div>

  <footer>
    <a href="index.html" class="footer-logo">Beat <span>the Bots</span> Daily</a>
    <ul class="footer-links">
      <li><a href="#">YouTube</a></li><li><a href="#">Instagram</a></li><li><a href="#">TikTok</a></li><li><a href="models.html">Models</a></li><li><a href="#">Privacy</a></li>
    </ul>
    <div class="footer-copy">&copy; 2026 Beat the Bots Daily</div>
  </footer>

  <script src="js/config.js"></script>
  <script>
    const DISPLAY_NAMES = { 'GPT-5.2': 'GPT-4o' };
    function dName(raw) { return DISPLAY_NAMES[raw] || raw; }

    const DAYS = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

    function fmtDate(iso) {
      if (!iso) return '—';
      const [y, m, d] = iso.split('-').map(Number);
      return `${MONTHS[m-1]} ${d}, ${y}`;
    }

    function getDayName(iso) {
      const [y, m, d] = iso.split('-').map(Number);
      return DAYS[new Date(y, m - 1, d).getDay()];
    }

    function ptsClass(pts) {
      if (pts == null) return '';
      if (pts >= 5) return 'score-good';
      if (pts >= 3) return 'score-ok';
      return 'score-bad';
    }

    function gameScore(gameKey, r) {
      if (gameKey === 'wordle') {
        if (r.solved) return { text: `${r.attempts_used}/6`, cls: ptsClass(r.points) };
        return { text: 'X/6', cls: 'score-bad' };
      }
      if (gameKey === 'connections') {
        return { text: r.solved ? 'Solved ✓' : 'Failed ✗', cls: r.solved ? 'score-good' : 'score-bad' };
      }
      if (gameKey === 'strands') {
        if (r.solved) return { text: 'Solved ✓', cls: 'score-good' };
        if (r.points > 0) return { text: `${r.points} pts`, cls: ptsClass(r.points) };
        return { text: 'Failed ✗', cls: 'score-bad' };
      }
      if (gameKey === 'keyword') {
        if (!r.solved) return { text: 'Failed', cls: 'score-bad' };
        if (r.attempts_used <= 6) return { text: `${r.attempts_used}/6`, cls: ptsClass(r.points) };
        return { text: `${r.points} pts`, cls: ptsClass(r.points) };
      }
      return { text: '—', cls: '' };
    }

    function publisherLabel(pub) {
      if (pub === 'NYT') return 'New York Times';
      if (pub === 'WaPo') return 'Washington Post';
      return pub;
    }

    function renderResults(data) {
      const { date, games } = data;

      // Update date header
      document.getElementById('today-day').textContent = getDayName(date);
      document.getElementById('today-date').textContent = fmtDate(date);
      document.getElementById('embed-title').textContent = `Daily Recap · ${fmtDate(date)}`;
      document.getElementById('results-date-label').textContent = fmtDate(date);

      const gameOrder = ['wordle', 'connections', 'strands', 'keyword'];

      const cards = gameOrder.map(gk => {
        const g = games[gk];
        if (!g) return '';

        const rows = g.results.map(r => {
          const sc = gameScore(gk, r);
          let badge = '';
          if (r.winner && !r.tied) badge = `<span class="winner-badge">Winner</span>`;
          else if (r.winner && r.tied) badge = `<span class="winner-badge">Tied</span>`;

          return `<div class="result-row">
            <div class="result-model">
              <div class="dot" style="background:${r.accent_color}"></div>
              ${dName(r.model_name)}${badge}
            </div>
            <div class="result-score ${sc.cls}">${sc.text}</div>
          </div>`;
        }).join('');

        return `<div class="card game-card bracketed">
          <div class="game-card-header">
            <div class="game-title">${g.game_name}</div>
            <div class="game-meta">${publisherLabel(g.publisher)}</div>
          </div>
          ${rows}
        </div>`;
      }).join('');

      document.getElementById('games-grid-container').innerHTML =
        `<div class="games-grid">${cards}</div>`;
    }

    async function loadResults() {
      try {
        const data = await apiFetch('/api/results/today');
        renderResults(data);
      } catch (_) {
        document.getElementById('games-grid-container').innerHTML = `
          <div class="error-state">
            <strong>Results unavailable</strong>
            Check back soon
          </div>`;
      }
    }

    async function loadLatestVideo() {
      try {
        const v = await apiFetch('/api/videos/latest?game_type=wordle');
        const container = document.getElementById('episode-embed-container');
        container.innerHTML =
          `<iframe src="${v.embed_url}?rel=0&modestbranding=1"
            title="${v.title}"
            frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen style="width:100%;height:100%;position:absolute;top:0;left:0;"></iframe>`;
        container.style.position = 'relative';
        document.getElementById('embed-title').textContent = v.title;
        const ytLink = document.getElementById('episode-yt-link');
        if (ytLink) { ytLink.href = v.watch_url; }
      } catch (_) {
        // Leave placeholder in place if no video available
      }
    }

    loadResults();
    loadLatestVideo();
  </script>
</body>
</html>
