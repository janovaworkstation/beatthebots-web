<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Episodes — Beat the Bots Daily</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,400;1,700&family=Courier+Prime:wght@400;700&family=EB+Garamond:ital,wght@0,400;1,400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/shared.css" />
  <style>
    /* ── EPISODES-SPECIFIC ── */
    .filter-bar {
      display: flex; gap: 0; flex-wrap: wrap;
    }
    .filter-btn {
      font-family: 'Courier Prime', monospace;
      font-size: 10px; letter-spacing: 0.2em; text-transform: uppercase;
      color: var(--cream-dim); background: none;
      border: 1px solid var(--muted); padding: 9px 20px;
      cursor: pointer; transition: all 0.2s;
    }
    .filter-btn:not(:last-child) { border-right: none; }
    .filter-btn.active { background: var(--gold); color: var(--bg); border-color: var(--gold); }
    .filter-btn:hover:not(.active) { border-color: var(--gold-dim); color: var(--gold); }

    .episodes-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    .ep-card { cursor: pointer; display: block; }
    .ep-thumb {
      width: 100%; aspect-ratio: 16/9;
      background: var(--bg-elevated);
      border: 1px solid var(--muted);
      display: flex; align-items: center; justify-content: center;
      position: relative; overflow: hidden; margin-bottom: 14px;
      transition: border-color 0.2s;
    }
    .ep-card:hover .ep-thumb { border-color: var(--gold-dim); }
    .ep-thumb img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
    .ep-thumb-bg { position: absolute; inset: 0; background: linear-gradient(135deg, var(--bg-elevated), #2A1810); }
    .ep-play {
      position: relative; z-index: 1;
      width: 40px; height: 40px; border: 1px solid var(--gold-dim);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      transition: border-color 0.2s, background 0.2s;
    }
    .ep-card:hover .ep-play { border-color: var(--gold); background: rgba(201,160,82,0.1); }
    .ep-tri { width:0; height:0; border-top:7px solid transparent; border-bottom:7px solid transparent; border-left:12px solid var(--gold); margin-left:3px; }

    .ep-type { font-family: 'Courier Prime', monospace; font-size: 9px; letter-spacing: 0.22em; text-transform: uppercase; color: var(--gold); margin-bottom: 5px; }
    .ep-title { font-family: 'Playfair Display', serif; font-size: 16px; font-weight: 700; color: var(--cream); line-height: 1.3; margin-bottom: 5px; }
    .ep-date { font-family: 'Courier Prime', monospace; font-size: 9px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); }

    /* featured ep */
    .ep-featured {
      display: grid; grid-template-columns: 1.6fr 1fr;
      gap: 32px; align-items: center; margin-bottom: 48px;
    }
    .ep-featured .ep-thumb { margin-bottom: 0; aspect-ratio: 16/9; }
    .ep-featured .ep-play { width: 56px; height: 56px; }
    .ep-featured .ep-tri { border-top-width: 10px; border-bottom-width: 10px; border-left-width: 17px; }
    .ep-featured-label { font-family: 'Courier Prime', monospace; font-size: 10px; letter-spacing: 0.22em; text-transform: uppercase; color: var(--gold); margin-bottom: 10px; }
    .ep-featured-title { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 700; color: var(--cream); line-height: 1.2; margin-bottom: 10px; }
    .ep-featured-date { font-family: 'Courier Prime', monospace; font-size: 10px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); margin-bottom: 16px; }

    /* filter rows */
    .filter-rows { margin-bottom: 24px; }
    .filter-row {
      display: flex; align-items: center;
      justify-content: space-between;
      flex-wrap: wrap; gap: 12px;
      margin-bottom: 8px;
    }
    .filter-row:not(:first-child) { justify-content: flex-end; }
    .filter-row:last-child { margin-bottom: 0; }

    /* load more */
    .load-more-wrap { text-align: center; padding: 32px 0 8px; }
    .load-more-btn {
      font-family: 'Courier Prime', monospace;
      font-size: 10px; letter-spacing: 0.2em; text-transform: uppercase;
      color: var(--cream-dim); background: none;
      border: 1px solid var(--muted); padding: 11px 32px;
      cursor: pointer; transition: all 0.2s;
    }
    .load-more-btn:hover { border-color: var(--gold-dim); color: var(--gold); }
    .load-more-count { color: var(--muted); }

    /* loading / error / empty states */
    .loading-state, .error-state, .empty-state {
      padding: 64px 0;
      text-align: center;
      font-family: 'Courier Prime', monospace;
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }
    .loading-state { color: var(--muted); }
    .error-state { color: var(--gold-dim); }
    .error-state strong { display: block; color: var(--cream-dim); font-size: 14px; margin-bottom: 8px; letter-spacing: 0.1em; }
    .error-state .retry-btn { margin-top: 16px; display: inline-block; background: none; border: 1px solid var(--gold-dim); color: var(--gold); font-family: 'Courier Prime', monospace; font-size: 10px; letter-spacing: 0.18em; text-transform: uppercase; padding: 6px 16px; cursor: pointer; }
    .error-state .retry-btn:hover { border-color: var(--gold); background: rgba(201,160,82,0.08); }
    .empty-state { color: var(--muted); }

    @media (max-width: 900px) {
      .episodes-grid { grid-template-columns: repeat(2, 1fr); }
      .ep-featured { grid-template-columns: 1fr; }
    }
    @media (max-width: 560px) {
      .episodes-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <nav>
    <a href="index.html" class="nav-logo">Beat <span>the Bots</span> Daily</a>
    <ul class="nav-links">
      <li><a href="standings.html">Standings</a></li>
      <li><a href="today.html">Results</a></li>
      <li><a href="episodes.html" class="active">Episodes</a></li>
      <li><a href="models.html">Models</a></li>
    </ul>
    <a href="index.html#waitlist" class="nav-cta">Join Waitlist</a>
    <button class="nav-hamburger" onclick="document.querySelector('.nav-links').classList.toggle('open')">☰</button>
  </nav>

  <div class="page-content">

    <div class="band band-dark">
      <div class="inner" style="padding-bottom:48px;border-bottom:1px solid var(--muted);">
        <span class="label">YouTube Channel</span>
        <h1 class="page-title serif">Episodes</h1>
      </div>
    </div>

    <div class="band band-dark">
      <div class="inner">

        <!-- FEATURED (latest comparison video) -->
        <span class="label" style="margin-bottom:20px;">Latest</span>
        <div id="featured-container">
          <div class="loading-state">Loading latest episode…</div>
        </div>

        <!-- FILTERS -->
        <div class="filter-rows">

          <!-- Row 1: label + game filter -->
          <div class="filter-row">
            <span class="label" style="margin-bottom:0;">All Episodes</span>
            <div class="filter-bar" id="game-filter">
              <button class="filter-btn active" onclick="setFilter('game','all',this)">All</button>
              <button class="filter-btn" onclick="setFilter('game','wordle',this)">Wordle</button>
              <button class="filter-btn" onclick="setFilter('game','connections',this)">Connections</button>
              <button class="filter-btn" onclick="setFilter('game','strands',this)">Strands</button>
              <button class="filter-btn" onclick="setFilter('game','keyword',this)">Keyword</button>
            </div>
          </div>

          <!-- Row 2: model filter (built dynamically) -->
          <div class="filter-row">
            <div class="filter-bar" id="model-filter">
              <button class="filter-btn active" onclick="setFilter('model','all',this)">All Models</button>
              <!-- model buttons added by JS after data loads -->
            </div>
          </div>

          <!-- Row 3: time filter -->
          <div class="filter-row">
            <div class="filter-bar" id="time-filter">
              <button class="filter-btn active" onclick="setFilter('time','all',this)">All Time</button>
              <button class="filter-btn" onclick="setFilter('time','week',this)">This Week</button>
              <button class="filter-btn" onclick="setFilter('time','lastweek',this)">Last Week</button>
            </div>
          </div>

        </div>

        <!-- GRID -->
        <div id="episodes-grid-container">
          <div class="loading-state">Loading episodes…</div>
        </div>

      </div>
    </div>

  </div>

  <footer>
    <a href="index.html" class="footer-logo">Beat <span>the Bots</span> Daily</a>
    <ul class="footer-links">
      <li><a href="#">YouTube</a></li><li><a href="#">Instagram</a></li><li><a href="#">TikTok</a></li><li><a href="models.html">Models</a></li><li><a href="#">Privacy</a></li>
    </ul>
    <div class="footer-copy">&copy; 2026 Beat the Bots Daily</div>
  </footer>

  <script src="js/config.js"></script>
  <script>
    // ── Constants ─────────────────────────────────────────────────────────────
    const PAGE_SIZE = 12;
    const DISPLAY_NAMES = { 'GPT-5.2': 'GPT-4o' };
    function dName(raw) { return DISPLAY_NAMES[raw] || raw; }

    const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    function fmtDate(iso) {
      if (!iso) return '—';
      const [y, m, d] = iso.split('-').map(Number);
      return `${MONTHS[m-1]} ${d}, ${y}`;
    }

    function epTypeLabel(v) {
      const game = v.game_type ? v.game_type.charAt(0).toUpperCase() + v.game_type.slice(1) : 'Video';
      if (v.is_comparison) return `AI vs ${game}`;
      return v.model_name ? `${dName(v.model_name)} · ${game}` : game;
    }

    function thumbHTML(v, large) {
      const playSize = large ? 'width:56px;height:56px' : 'width:40px;height:40px';
      const triStyle = large
        ? 'border-top-width:10px;border-bottom-width:10px;border-left-width:17px'
        : '';
      const img = v.thumbnail_url
        ? `<img src="${v.thumbnail_url}" alt="${v.title}" loading="lazy" />`
        : '<div class="ep-thumb-bg"></div>';
      return `${img}<div class="ep-play" style="${playSize}"><div class="ep-tri" style="${triStyle}"></div></div>`;
    }

    // ── State ─────────────────────────────────────────────────────────────────
    let allVideos = [];
    let displayedCount = PAGE_SIZE;
    let activeFilters = { game: 'all', model: 'all', time: 'all' };

    // ── Filter logic ──────────────────────────────────────────────────────────
    function setFilter(type, value, btn) {
      document.querySelectorAll('#' + type + '-filter .filter-btn')
        .forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeFilters[type] = value;
      displayedCount = PAGE_SIZE;
      renderFiltered();
    }

    function getFilteredVideos() {
      return allVideos.filter(v => {
        // Game filter
        if (activeFilters.game !== 'all' && v.game_type !== activeFilters.game) return false;
        // Model filter: specific model hides comparison videos
        if (activeFilters.model !== 'all') {
          if (v.is_comparison || v.model_name !== activeFilters.model) return false;
        }
        // Time filter
        if (activeFilters.time !== 'all') {
          const dateStr = v.game_date || (v.published_at ? v.published_at.split('T')[0] : null);
          if (dateStr) {
            const [y, mo, d] = dateStr.split('-').map(Number);
            const videoDay = new Date(y, mo - 1, d);
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const diffDays = Math.round((today - videoDay) / 86400000);
            if (activeFilters.time === 'week' && diffDays > 7) return false;
            if (activeFilters.time === 'lastweek' && (diffDays <= 7 || diffDays > 14)) return false;
          }
        }
        return true;
      });
    }

    function renderFiltered() {
      renderGrid(getFilteredVideos());
    }

    // ── Featured section ──────────────────────────────────────────────────────
    function renderFeatured(v) {
      document.getElementById('featured-container').innerHTML = `
        <div class="ep-featured">
          <div class="ep-thumb bracketed" style="position:relative;">
            <iframe src="${v.embed_url}?rel=0&modestbranding=1"
              title="${v.title}" frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>
          </div>
          <div>
            <div class="ep-featured-label">${epTypeLabel(v)}</div>
            <div class="ep-featured-title">${v.title.split(' | ')[0]}</div>
            <div class="ep-featured-date">${fmtDate(v.game_date || v.published_at)}</div>
            <a href="${v.watch_url}" target="_blank" rel="noopener"
              style="font-family:'Courier Prime',monospace;font-size:10px;letter-spacing:0.15em;text-transform:uppercase;color:var(--gold);text-decoration:none;">
              Watch on YouTube →
            </a>
          </div>
        </div>`;
    }

    // ── Grid + Load More ──────────────────────────────────────────────────────
    function playVideo(cardEl, embedUrl, title) {
      const thumb = cardEl.querySelector('.ep-thumb');
      thumb.innerHTML = `<iframe src="${embedUrl}?rel=0&modestbranding=1&autoplay=1"
        title="${title}" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>`;
      thumb.style.position = 'relative';
      cardEl.style.cursor = 'default';
      cardEl.onclick = null;
    }

    function renderGrid(videos) {
      const container = document.getElementById('episodes-grid-container');

      if (!videos.length) {
        container.innerHTML = `<div class="empty-state">No episodes for this selection</div>`;
        return;
      }

      const slice = videos.slice(0, displayedCount);
      const cards = slice.map(v => `
        <div class="ep-card" data-embed="${v.embed_url}" data-title="${v.title}">
          <div class="ep-thumb">${thumbHTML(v, false)}</div>
          <div class="ep-type">${epTypeLabel(v)}</div>
          <div class="ep-title">${v.title.split(' | ')[0]}</div>
          <div class="ep-date">${fmtDate(v.game_date || v.published_at)}</div>
        </div>`).join('');

      const remaining = videos.length - displayedCount;
      const loadMoreHTML = remaining > 0 ? `
        <div class="load-more-wrap">
          <button class="load-more-btn" onclick="loadMore()">
            Load More <span class="load-more-count">(${remaining} more)</span>
          </button>
        </div>` : '';

      container.innerHTML = `<div class="episodes-grid">${cards}</div>${loadMoreHTML}`;

      container.querySelectorAll('.ep-card').forEach(card => {
        card.addEventListener('click', () => {
          playVideo(card, card.dataset.embed, card.dataset.title);
        });
      });
    }

    function loadMore() {
      displayedCount += PAGE_SIZE;
      renderFiltered();
    }

    // ── Init ──────────────────────────────────────────────────────────────────
    async function init() {
      try {
        const data = await apiFetch('/api/videos');
        allVideos = data.videos;

        // Featured = latest comparison video
        const featured = allVideos.find(v => v.is_comparison);
        if (featured) renderFeatured(featured);
        else document.getElementById('featured-container').innerHTML = '';

        // Build model filter buttons from actual data
        const modelBar = document.getElementById('model-filter');
        const modelNames = [...new Set(
          allVideos.filter(v => v.model_name && !v.is_comparison).map(v => v.model_name)
        )].sort();
        modelNames.forEach(rawName => {
          const btn = document.createElement('button');
          btn.className = 'filter-btn';
          btn.textContent = dName(rawName);
          btn.onclick = function() { setFilter('model', rawName, this); };
          modelBar.appendChild(btn);
        });

        renderFiltered();
      } catch (_) {
        document.getElementById('featured-container').innerHTML = '';
        document.getElementById('episodes-grid-container').innerHTML = `
          <div class="error-state">
            <strong>Episodes unavailable</strong>
            Check back soon
            <button class="retry-btn" onclick="loadEpisodes()">Try Again</button>
          </div>`;
      }
    }

    init();
  </script>

</body>
</html>
