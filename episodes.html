<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Episodes — Beat the Bots Daily</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,400;1,700&family=Courier+Prime:wght@400;700&family=EB+Garamond:ital,wght@0,400;1,400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/shared.css" />
  <style>
    /* ── EPISODES-SPECIFIC ── */
    .filter-bar {
      display: flex; gap: 0; flex-wrap: wrap;
    }
    .filter-btn {
      font-family: 'Courier Prime', monospace;
      font-size: 10px; letter-spacing: 0.2em; text-transform: uppercase;
      color: var(--cream-dim); background: none;
      border: 1px solid var(--muted); padding: 9px 20px;
      cursor: pointer; transition: all 0.2s;
    }
    .filter-btn:not(:last-child) { border-right: none; }
    .filter-btn.active { background: var(--gold); color: var(--bg); border-color: var(--gold); }
    .filter-btn:hover:not(.active) { border-color: var(--gold-dim); color: var(--gold); }

    .episodes-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    .ep-card { cursor: pointer; display: block; }
    .ep-thumb {
      width: 100%; aspect-ratio: 16/9;
      background: var(--bg-elevated);
      border: 1px solid var(--muted);
      display: flex; align-items: center; justify-content: center;
      position: relative; overflow: hidden; margin-bottom: 14px;
      transition: border-color 0.2s;
    }
    .ep-card:hover .ep-thumb { border-color: var(--gold-dim); }
    .ep-thumb img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
    .ep-thumb-bg { position: absolute; inset: 0; background: linear-gradient(135deg, var(--bg-elevated), #2A1810); }
    .ep-play {
      position: relative; z-index: 1;
      width: 40px; height: 40px; border: 1px solid var(--gold-dim);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      transition: border-color 0.2s, background 0.2s;
    }
    .ep-card:hover .ep-play { border-color: var(--gold); background: rgba(201,160,82,0.1); }
    .ep-tri { width:0; height:0; border-top:7px solid transparent; border-bottom:7px solid transparent; border-left:12px solid var(--gold); margin-left:3px; }

    .ep-type { font-family: 'Courier Prime', monospace; font-size: 9px; letter-spacing: 0.22em; text-transform: uppercase; color: var(--gold); margin-bottom: 5px; }
    .ep-title { font-family: 'Playfair Display', serif; font-size: 16px; font-weight: 700; color: var(--cream); line-height: 1.3; margin-bottom: 5px; }
    .ep-date { font-family: 'Courier Prime', monospace; font-size: 9px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); }

    /* featured ep */
    .ep-featured {
      display: grid; grid-template-columns: 1.6fr 1fr;
      gap: 32px; align-items: center; margin-bottom: 48px;
    }
    .ep-featured .ep-thumb { margin-bottom: 0; aspect-ratio: 16/9; }
    .ep-featured .ep-play { width: 56px; height: 56px; }
    .ep-featured .ep-tri { border-top-width: 10px; border-bottom-width: 10px; border-left-width: 17px; }
    .ep-featured-label { font-family: 'Courier Prime', monospace; font-size: 10px; letter-spacing: 0.22em; text-transform: uppercase; color: var(--gold); margin-bottom: 10px; }
    .ep-featured-title { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 700; color: var(--cream); line-height: 1.2; margin-bottom: 10px; }
    .ep-featured-date { font-family: 'Courier Prime', monospace; font-size: 10px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); margin-bottom: 16px; }

    /* loading / error / empty states */
    .loading-state, .error-state, .empty-state {
      padding: 64px 0;
      text-align: center;
      font-family: 'Courier Prime', monospace;
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }
    .loading-state { color: var(--muted); }
    .error-state { color: var(--gold-dim); }
    .error-state strong { display: block; color: var(--cream-dim); font-size: 14px; margin-bottom: 8px; letter-spacing: 0.1em; }
    .empty-state { color: var(--muted); }

    @media (max-width: 900px) {
      .episodes-grid { grid-template-columns: repeat(2, 1fr); }
      .ep-featured { grid-template-columns: 1fr; }
    }
    @media (max-width: 560px) {
      .episodes-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <nav>
    <a href="index.html" class="nav-logo">Beat <span>the Bots</span> Daily</a>
    <ul class="nav-links">
      <li><a href="standings.html">Standings</a></li>
      <li><a href="today.html">Today</a></li>
      <li><a href="episodes.html" class="active">Episodes</a></li>
      <li><a href="models.html">Models</a></li>
    </ul>
    <a href="index.html#waitlist" class="nav-cta">Join Waitlist</a>
    <button class="nav-hamburger" onclick="document.querySelector('.nav-links').classList.toggle('open')">☰</button>
  </nav>

  <div class="page-content">

    <div class="band band-dark">
      <div class="inner" style="padding-bottom:48px;border-bottom:1px solid var(--muted);">
        <span class="label">YouTube Channel</span>
        <h1 class="page-title serif">Episodes</h1>
      </div>
    </div>

    <div class="band band-dark">
      <div class="inner">

        <!-- FEATURED (latest comparison video) -->
        <span class="label" style="margin-bottom:20px;">Latest</span>
        <div id="featured-container">
          <div class="loading-state">Loading latest episode…</div>
        </div>

        <!-- FILTER + GRID -->
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:12px;">
          <span class="label" style="margin-bottom:0;">All Episodes</span>
          <div class="filter-bar">
            <button class="filter-btn active" onclick="filterEps(this,'all')">All</button>
            <button class="filter-btn" onclick="filterEps(this,'wordle')">Wordle</button>
            <button class="filter-btn" onclick="filterEps(this,'connections')">Connections</button>
            <button class="filter-btn" onclick="filterEps(this,'strands')">Strands</button>
            <button class="filter-btn" onclick="filterEps(this,'keyword')">Keyword</button>
          </div>
        </div>

        <div id="episodes-grid-container">
          <div class="loading-state">Loading episodes…</div>
        </div>

      </div>
    </div>

  </div>

  <footer>
    <a href="index.html" class="footer-logo">Beat <span>the Bots</span> Daily</a>
    <ul class="footer-links">
      <li><a href="#">YouTube</a></li><li><a href="#">Instagram</a></li><li><a href="#">TikTok</a></li><li><a href="models.html">Models</a></li><li><a href="#">Privacy</a></li>
    </ul>
    <div class="footer-copy">&copy; 2026 Beat the Bots Daily</div>
  </footer>

  <script src="js/config.js"></script>
  <script>
    const DISPLAY_NAMES = { 'GPT-5.2': 'GPT-4o' };
    function dName(raw) { return DISPLAY_NAMES[raw] || raw; }

    const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    function fmtDate(iso) {
      if (!iso) return '—';
      const [y, m, d] = iso.split('-').map(Number);
      return `${MONTHS[m-1]} ${d}, ${y}`;
    }

    function epTypeLabel(v) {
      const game = v.game_type ? v.game_type.charAt(0).toUpperCase() + v.game_type.slice(1) : 'Video';
      if (v.is_comparison) return `AI vs ${game}`;
      return v.model_name ? `${dName(v.model_name)} · ${game}` : game;
    }

    function thumbHTML(v, large) {
      const playSize = large ? 'width:56px;height:56px' : 'width:40px;height:40px';
      const triStyle = large
        ? 'border-top-width:10px;border-bottom-width:10px;border-left-width:17px'
        : '';
      const img = v.thumbnail_url
        ? `<img src="${v.thumbnail_url}" alt="${v.title}" loading="lazy" />`
        : '<div class="ep-thumb-bg"></div>';
      return `${img}<div class="ep-play" style="${playSize}"><div class="ep-tri" style="${triStyle}"></div></div>`;
    }

    // ── All videos data (stored for filtering) ────────────────────────────────
    let allVideos = [];
    let activeFilter = 'all';

    // ── Featured section ──────────────────────────────────────────────────────
    function renderFeatured(v) {
      document.getElementById('featured-container').innerHTML = `
        <div class="ep-featured">
          <div class="ep-thumb bracketed" style="position:relative;">
            <iframe src="${v.embed_url}?rel=0&modestbranding=1"
              title="${v.title}" frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>
          </div>
          <div>
            <div class="ep-featured-label">${epTypeLabel(v)}</div>
            <div class="ep-featured-title">${v.title.split(' | ')[0]}</div>
            <div class="ep-featured-date">${fmtDate(v.game_date || v.published_at)}</div>
            <a href="${v.watch_url}" target="_blank" rel="noopener"
              style="font-family:'Courier Prime',monospace;font-size:10px;letter-spacing:0.15em;text-transform:uppercase;color:var(--gold);text-decoration:none;">
              Watch on YouTube →
            </a>
          </div>
        </div>`;
    }

    // ── Episodes grid ─────────────────────────────────────────────────────────
    function playVideo(cardEl, embedUrl, title) {
      const thumb = cardEl.querySelector('.ep-thumb');
      thumb.innerHTML = `<iframe src="${embedUrl}?rel=0&modestbranding=1&autoplay=1"
        title="${title}" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>`;
      thumb.style.position = 'relative';
      cardEl.style.cursor = 'default';
      cardEl.onclick = null;
    }

    function renderGrid(videos) {
      if (!videos.length) {
        document.getElementById('episodes-grid-container').innerHTML =
          `<div class="empty-state">No episodes yet for this game type</div>`;
        return;
      }
      const cards = videos.map(v => `
        <div class="ep-card" data-embed="${v.embed_url}" data-title="${v.title}" data-type="${v.game_type || 'other'}">
          <div class="ep-thumb">${thumbHTML(v, false)}</div>
          <div class="ep-type">${epTypeLabel(v)}</div>
          <div class="ep-title">${v.title.split(' | ')[0]}</div>
          <div class="ep-date">${fmtDate(v.game_date || v.published_at)}</div>
        </div>`).join('');
      document.getElementById('episodes-grid-container').innerHTML =
        `<div class="episodes-grid">${cards}</div>`;

      // Attach click handlers
      document.querySelectorAll('#episodes-grid-container .ep-card').forEach(card => {
        card.addEventListener('click', () => {
          playVideo(card, card.dataset.embed, card.dataset.title);
        });
      });
    }

    // ── Filter handler ────────────────────────────────────────────────────────
    function filterEps(btn, type) {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeFilter = type;
      const filtered = type === 'all'
        ? allVideos
        : allVideos.filter(v => v.game_type === type);
      renderGrid(filtered);
    }

    // ── Init ──────────────────────────────────────────────────────────────────
    async function init() {
      // Load all videos
      try {
        const data = await apiFetch('/api/videos');
        allVideos = data.videos;

        // Featured = latest comparison video
        const featured = allVideos.find(v => v.is_comparison);
        if (featured) renderFeatured(featured);
        else document.getElementById('featured-container').innerHTML = '';

        renderGrid(allVideos);
      } catch (_) {
        document.getElementById('featured-container').innerHTML = '';
        document.getElementById('episodes-grid-container').innerHTML = `
          <div class="error-state">
            <strong>Episodes unavailable</strong>
            Check back soon
          </div>`;
      }
    }

    init();
  </script>

</body>
</html>
